<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>8086 Mini Simulator + Morse ↔ Text ↔ Assembly</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #000000;
  --panel: #0a0a0a;
  --muted: #00ff00;
  --accent: #00cc00;
  --accent2: #00ff66;
  --card: #0a0a0a;
  --glow: #00ff00;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: 'VT323', monospace; color: var(--muted); background: var(--bg); }
.container { max-width: 1300px; margin: 20px auto; padding: 18px; display: grid; grid-template-columns: 1fr 420px 300px; gap: 16px; }
.header { grid-column: 1/-1; display: flex; align-items: center; justify-content: space-between; }
.brand { display: flex; align-items: center; gap: 12px; }
.logo { width: 44px; height: 44px; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--bg); text-shadow: 0 0 5px var(--glow); }
h1 { font-size: 18px; margin: 0; text-shadow: 0 0 3px var(--glow); }
.card { background: var(--card); border: 1px solid var(--accent); padding: 12px; border-radius: 0; box-shadow: 0 0 10px var(--glow); }
.editor { height: 420px; display: flex; flex-direction: column; }
textarea.code { flex: 1; width: 100%; resize: none; background: var(--bg); border: 1px solid var(--accent); padding: 10px; color: var(--muted); font-family: 'VT323', monospace; font-size: 16px; text-shadow: 0 0 2px var(--glow); }
.controls { display: flex; gap: 8px; margin-top: 8px; }
.btn { background: var(--accent); border: 1px solid var(--accent2); padding: 8px 10px; border-radius: 0; color: var(--bg); font-weight: 600; cursor: pointer; text-shadow: 0 0 3px var(--glow); }
.btn:hover { background: var(--accent2); box-shadow: 0 0 5px var(--glow); }
.btn.ghost { background: transparent; border: 1px solid var(--accent); color: var(--muted); }
.side { display: flex; flex-direction: column; gap: 12px; }
.small { font-size: 14px; color: var(--muted); text-shadow: 0 0 2px var(--glow); }
.panel { padding: 10px; border-radius: 0; background: var(--panel); border: 1px solid var(--accent); box-shadow: 0 0 5px var(--glow); }
.row { display: flex; gap: 8px; }
.regs { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
.reg { padding: 6px; border-radius: 0; background: var(--bg); border: 1px solid var(--accent); font-family: 'VT323', monospace; text-shadow: 0 0 2px var(--glow); }
.console { height: 140px; overflow: auto; font-family: 'VT323', monospace; background: var(--bg); border: 1px solid var(--accent); padding: 8px; border-radius: 0; color: var(--muted); text-shadow: 0 0 2px var(--glow); }
label { font-size: 14px; color: var(--muted); }
.morseBox { display: flex; flex-direction: column; gap: 8px; }
.morseArea { width: 100%; height: 120px; padding: 8px; border-radius: 0; background: var(--bg); border: 1px solid var(--accent); font-family: 'VT323', monospace; color: var(--muted); text-shadow: 0 0 2px var(--glow); }
.footerNote { grid-column: 1/-1; color: var(--muted); font-size: 14px; margin-top: 8px; text-shadow: 0 0 2px var(--glow); }
textarea.asmOutput { height: 180px; resize: none; font-family: 'VT323', monospace; background: var(--bg); border: 1px solid var(--accent); padding: 8px; color: var(--muted); text-shadow: 0 0 2px var(--glow); }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <div class="logo">86</div>
      <div>
        <h1>8086 Mini Simulator + Morse ↔ Text ↔ Assembly</h1>
        <div class="small">Assembler (subset), live Morse converter, Text → ASM generator</div>
      </div>
    </div>
    <div style="text-align:right">
      <div class="small">Save file as <kbd>8086-sim.html</kbd> and open in browser</div>
    </div>
  </div>

  <!-- Main Editor -->
  <div>
    <div class="card editor">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:6px">
        <div><label class="small">Assembly editor / Morse input</label></div>
        <div class="row">
          <button class="btn" id="assembleBtn">Assemble & Run</button>
          <button class="btn ghost" id="stepBtn">Step</button>
          <button class="btn ghost" id="resetBtn">Reset</button>
        </div>
      </div>
      <textarea id="code" class="code" spellcheck="false">; Type here or paste generated ASM code</textarea>
      <div class="controls">
        <button class="btn ghost" id="compileBtn">Compile (assemble)</button>
        <button class="btn ghost" id="downloadBtn">Download .asm</button>
        <div style="flex:1"></div>
        <label class="small" style="align-self:center">Speed:</label>
        <input id="speed" type="range" min="50" max="1200" value="300" />
      </div>
    </div>

    <div style="height:12px"></div>
    <div class="card panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><label class="small">Console</label></div>
        <div class="small"><button class="btn ghost" id="clearConsole">Clear</button></div>
      </div>
      <pre id="console" class="console"></pre>
    </div>
  </div>

  <!-- Side panel: Morse + Registers + Controls -->
  <div class="side">
    <div class="card panel">
      <label class="small">Morse ↔ Text (live)</label>
      <div class="morseBox">
        <textarea id="morseInput" class="morseArea" placeholder="Type text here to convert to Morse, or paste Morse (.- -...) to convert to text"></textarea>
        <div style="display:flex;gap:8px">
          <button class="btn" id="toMorse">Text → Morse</button>
          <button class="btn" id="toText">Morse → Text</button>
          <button class="btn ghost" id="pasteToEditor">Decode → Editor</button>
          <button class="btn ghost" id="copyMorse">Copy</button>
        </div>
        <div class="small">Letters separated by space, words by <kbd>/</kbd> or double space. Press <kbd>Decode → Editor</kbd> to replace editor text with decoded assembly.</div>
      </div>
    </div>

    <div class="card panel">
      <label class="small">Registers</label>
      <div class="regs" id="regs"></div>
    </div>

    <div class="card panel">
      <label class="small">Flags & Controls</label>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <div class="small">ZF:</div><div id="zf" class="reg">0</div>
        <div class="small">SF:</div><div id="sf" class="reg">0</div>
        <div class="small">IP:</div><div id="ip" class="reg">0</div>
      </div>
      <div style="height:8px"></div>
      <div style="display:flex;gap:8px">
        <button class="btn" id="runBtn">Run</button>
        <button class="btn ghost" id="pauseBtn">Pause</button>
        <button class="btn ghost" id="stopBtn">Stop</button>
      </div>
    </div>
  </div>

  <!-- New panel: Text → Assembly -->
  <div class="side">
    <div class="card panel">
      <label class="small">Text → Assembly Generator</label>
      <textarea id="textInput" class="morseArea" placeholder="Type words or sentence here"></textarea>
      <textarea id="asmOutput" class="asmOutput" readonly placeholder="Generated assembly will appear here"></textarea>
      <div style="display:flex;gap:8px; margin-top:4px">
        <button class="btn" id="generateASM">Generate ASM</button>
        <button class="btn ghost" id="copyASM">Copy</button>
        <button class="btn ghost" id="pasteASM">Paste to Editor</button>
      </div>
      <div class="small">Generates MOV/OUT instructions for each character (. = 46, - = 45, / = 47, space between letters as 47)</div>
    </div>
  </div>

  <div class="footerNote">
    Tips: The assembler supports a small subset: MOV, ADD, SUB, INC, DEC, CMP, JMP, JE, JNE, OUT (prints register or Morse symbols), HLT, LABELS, immediate numbers (decimal) and AX,BX,CX,DX.<br>Created by Anirudh Ramakrishnan
  </div>
</div>

<script>
// Morse definitions
const MORSE = { 'A':'.-','B':'-...','C':'-.-.','D':'-..','E':'.','F':'..-.','G':'--.','H':'....','I':'..','J':'.---','K':'-.-','L':'.-..','M':'--','N':'-.','O':'---','P':'.--.','Q':'--.-','R':'.-.','S':'...','T':'-','U':'..-','V':'...-','W':'.--','X':'-..-','Y':'-.--','Z':'--..','0':'-----','1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.','.' :'.-.-.-',',':'--..--','?':'..--..','!':'-.-.--','/':'-..-.','(':'-.--.',')':'-.--.-','&':'.-...',':':'---...',';':'-.-.-.','=':'-...-','+':'.-.-.','-':'-....-','_':'..--.-','"':'.-..-.','@':'.--.-.'};
const REV_MORSE = Object.fromEntries(Object.entries(MORSE).map(([k,v])=>[v,k]));

// Elements
const codeEl = document.getElementById('code');
const morseEl = document.getElementById('morseInput');
const toMorseBtn = document.getElementById('toMorse');
const toTextBtn = document.getElementById('toText');
const pasteToEditor = document.getElementById('pasteToEditor');
const copyMorse = document.getElementById('copyMorse');
const assembleBtn = document.getElementById('assembleBtn');
const compileBtn = document.getElementById('compileBtn');
const runBtn = document.getElementById('runBtn');
const stepBtn = document.getElementById('stepBtn');
const resetBtn = document.getElementById('resetBtn');
const consoleEl = document.getElementById('console');
const regsDiv = document.getElementById('regs');
const zfEl = document.getElementById('zf');
const sfEl = document.getElementById('sf');
const ipEl = document.getElementById('ip');
const speedSlider = document.getElementById('speed');
const clearConsoleBtn = document.getElementById('clearConsole');
const downloadBtn = document.getElementById('downloadBtn');

// Text → ASM
const textInput = document.getElementById('textInput');
const asmOutput = document.getElementById('asmOutput');
const generateASM = document.getElementById('generateASM');
const copyASM = document.getElementById('copyASM');
const pasteASM = document.getElementById('pasteASM');

// CPU simulator
let CPU = { regs:{AX:0,BX:0,CX:0,DX:0}, ip:0, zf:false,sf:false, mem:new Array(1024).fill(0), code:[], labels:{}, running:false, halted:false };

function resetCPU(){ CPU.regs={AX:0,BX:0,CX:0,DX:0}; CPU.ip=0; CPU.zf=false; CPU.sf=false; CPU.mem.fill(0); CPU.running=false; CPU.halted=false; updateUI(); }
resetCPU();

function logConsole(...args){ consoleEl.textContent += args.join('')+'\n'; consoleEl.scrollTop = consoleEl.scrollHeight; }
clearConsoleBtn.onclick = ()=>{ consoleEl.textContent=''; }

// Morse functions
function textToMorse(text){ return text.toUpperCase().split(' ').map(w=>w.split('').map(c=>MORSE[c]||'?').join(' ')).join(' / '); }
function morseToText(m){ return m.replace(/\|/g,' / ').split(/\s{2,}|\s\/\s/).map(w=>w.trim()).filter(Boolean).map(w=>w.split(/\s+/).map(s=>REV_MORSE[s]||'?').join('')).join(' '); }

toMorseBtn.onclick = ()=>{ morseEl.value = textToMorse(morseEl.value || codeEl.value); }
toTextBtn.onclick = ()=>{ morseEl.value = morseToText(morseEl.value); }
copyMorse.onclick = ()=>{ navigator.clipboard?.writeText(morseEl.value).then(()=>alert('Copied')) }
pasteToEditor.onclick = ()=>{ codeEl.value = morseToText(morseEl.value); }

// Tokenize & assemble
function tokenizeLine(line){ line=line.replace(/;.*$/,'').trim(); if(!line) return null; if(line.endsWith(':')) return {type:'label',label:line.slice(0,-1).trim()}; const parts=line.split(/[,\s]+/).filter(Boolean); return {type:'instr',op:parts[0].toUpperCase(),args:parts.slice(1)}; }
function assembleText(text){ const lines=text.split('\n'); const code=[]; const labels={}; let addr=0; for(let l of lines){ const t=tokenizeLine(l); if(!t) continue; if(t.type==='label') labels[t.label]=addr; else addr+=1; } for(let l of lines){ const t=tokenizeLine(l); if(!t) continue; if(t.type==='instr') code.push({op:t.op,args:t.args,srcLine:l}); } return {code,labels}; }
function getVal(tok){ if(typeof tok==='number') return tok; if(/^[0-9]+$/.test(tok)) return parseInt(tok,10); tok=tok.toUpperCase(); if(CPU.regs.hasOwnProperty(tok)) return CPU.regs[tok]; return 0; }
function setReg(r,v){ r=r.toUpperCase(); if(CPU.regs.hasOwnProperty(r)) CPU.regs[r]=v&0xFFFF; }
function updateFlagsFrom(v){ CPU.zf=(v===0); CPU.sf=(v<0); }
function stepInstruction(){ if(CPU.halted) return false; const instr=CPU.code[CPU.ip]; if(!instr){ CPU.halted=true; return false; } const op=instr.op.toUpperCase(); const a=instr.args[0], b=instr.args[1]; switch(op){ case 'MOV': setReg(a,getVal(b)); CPU.ip++; break; case 'ADD': setReg(a,getVal(a)+getVal(b)); updateFlagsFrom(getVal(a)); CPU.ip++; break; case 'SUB': setReg(a,getVal(a)-getVal(b)); updateFlagsFrom(getVal(a)); CPU.ip++; break; case 'INC': setReg(a,getVal(a)+1); updateFlagsFrom(getVal(a)); CPU.ip++; break; case 'DEC': setReg(a,getVal(a)-getVal(b)); updateFlagsFrom(getVal(a)); CPU.ip++; break; case 'CMP': const r=getVal(a)-getVal(b); CPU.zf=(r===0); CPU.sf=(r<0); CPU.ip++; break; case 'JMP': CPU.ip=resolveLabelOrNumber(a); break; case 'JE': if(CPU.zf) CPU.ip=resolveLabelOrNumber(a); else CPU.ip++; break; case 'JNE': if(!CPU.zf) CPU.ip=resolveLabelOrNumber(a); else CPU.ip++; break; case 'OUT': const v=getVal(a); consoleEl.textContent += (v>=33 && v<=126?String.fromCharCode(v):v); consoleEl.scrollTop = consoleEl.scrollHeight; CPU.ip++; break; case 'HLT': CPU.halted=true; CPU.running=false; break; default: logConsole('Unknown op:',op); CPU.halted=true; CPU.running=false; break; } return true; }
function resolveLabelOrNumber(x){ if(!isNaN(parseInt(x))) return parseInt(x); if(CPU.labels && CPU.labels[x]) return CPU.labels[x]; const key=Object.keys(CPU.labels).find(k=>k.toUpperCase()===String(x).toUpperCase()); return key?CPU.labels[key]:0; }
function loadProgramFromText(txt){ const {code,labels}=assembleText(txt); CPU.code=code; CPU.labels=labels; CPU.ip=0; CPU.halted=false; CPU.running=false; updateUI(); }

assembleBtn.onclick = ()=>{ loadProgramFromText(codeEl.value); runProgram(); }
compileBtn.onclick = ()=>{ const {code,labels}=assembleText(codeEl.value); alert('Assembled '+code.length+' instructions. Labels: '+Object.keys(labels).join(', ')); }

function updateUI(){ regsDiv.innerHTML=''; for(const r of ['AX','BX','CX','DX']){ const d=document.createElement('div'); d.className='reg'; d.textContent=r+': '+CPU.regs[r]; regsDiv.appendChild(d); } zfEl.textContent=CPU.zf?'1':'0'; sfEl.textContent=CPU.sf?'1':'0'; ipEl.textContent=CPU.ip; }

resetBtn.onclick = ()=>{ resetCPU(); if(codeEl.value) loadProgramFromText(codeEl.value); consoleEl.textContent=''; }

function runProgram(){ CPU.running=true; CPU.halted=false; let interval=setInterval(()=>{ if(!CPU.running||CPU.halted){ clearInterval(interval); return; } const ok=stepInstruction(); updateUI(); if(!ok||CPU.halted){ CPU.running=false; clearInterval(interval); } }, Math.max(20, parseInt(speedSlider.value))); }
runBtn.onclick = ()=>{ if(!CPU.code.length) loadProgramFromText(codeEl.value); runProgram(); }
document.getElementById('pauseBtn').onclick = ()=>{ CPU.running=false; }
document.getElementById('stopBtn').onclick = ()=>{ CPU.running=false; CPU.halted=true; }
downloadBtn.onclick = ()=>{ const blob=new Blob([codeEl.value],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='program.asm'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
loadProgramFromText(codeEl.value); updateUI();

// Text → ASM generator
const CHAR_MAP = {'.':46,'-':45,'/':47,' ':'47'};
function generateAssemblyFromText(txt){
  const lines = [];
  txt.toUpperCase().split('').forEach(c=>{
    if(c===' ') lines.push('MOV AX,47','OUT AX');
    else if(c==='.') lines.push('MOV AX,46','OUT AX');
    else if(c==='-') lines.push('MOV AX,45','OUT AX');
    else lines.push('MOV AX,'+c.charCodeAt(0),'OUT AX');
  });
  lines.push('HLT');
  return lines.join('\n');
}
generateASM.onclick = ()=>{ asmOutput.value=generateAssemblyFromText(textInput.value); }
copyASM.onclick = ()=>{ navigator.clipboard?.writeText(asmOutput.value).then(()=>alert('Copied')) }
pasteASM.onclick = ()=>{ codeEl.value=asmOutput.value; }

</script>
</body>
</html>
